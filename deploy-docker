#!/bin/bash

# ======================= COMMON FUNCTIONS ======================= #

# Function to fix permissions
fix_permissions() {
    echo "ğŸ”§ Fixing permissions in 'docker/supabase'..."
    sudo chmod -R 755 ./docker/supabase
    echo "âœ… Permissions fixed successfully."
}

# Function to deploy Supabase
deploy_supabase() {
    echo "ğŸš€ Deploying Supabase..."
    docker compose -f ./docker/supabase/docker-compose.yml up -d
    echo "âœ… Supabase deployed successfully."
}

# Function to stop Supabase
stop_supabase() {
    echo "ğŸ›‘ Stopping Supabase..."
    docker compose -f ./docker/supabase/docker-compose.yml down
    echo "âœ… Supabase stopped successfully."
}

# Function to deploy all services
deploy_all() {
    deploy_supabase
    fix_permissions
}

# Function to stop all services
stop_all() {
    stop_supabase
}

# ======================= MENU LOGIC ======================= #

# === Main Menu ===
main_menu() {
    echo "ğŸŒ Select an environment:"
    echo "1) Local"
    echo "2) Exit"

    read -p "Choose an option [1-4]: " env_option

    case $env_option in
        1) NODE_ENV="local"; local_menu ;;
        2) echo "ğŸ‘‹ Exiting..."; exit 0 ;;
        *) echo "âŒ Invalid option. Please choose a number between 1 and 4."; main_menu ;;
    esac
}



 # === Local All Menu ===
 all_menu() {
     echo "ğŸ”¹ All Services - Choose an action:"
     echo "1) Deploy"
     echo "2) Stop"
     echo "3) Back"

     read -p "Choose an option [1-3]: " all_option

     case $all_option in
         1) deploy_all ;;
         2) stop_all ;;
         3) local_menu ;;
         *) echo "âŒ Invalid option. Please choose a number between 1 and 3."; all_menu ;;
     esac
 }

 # === Local Supabase Menu ===
 supabase_menu() {
     echo "ğŸ”¹ Supabase - Choose an action:"
     echo "1) Deploy"
     echo "2) Stop"
     echo "3) Back"

     read -p "Choose an option [1-3]: " supabase_option

     case $supabase_option in
         1) deploy_supabase ;;
         2) stop_supabase ;;
         3) local_menu ;;
         *) echo "âŒ Invalid option. Please choose a number between 1 and 3."; supabase_menu ;;
     esac
 }



 # === Local Menu ===
 local_menu() {
      echo "ğŸ”¹ Select a category:"
      echo "1) All"
      echo "2) Supabase"
      echo "3) Back"
      echo "4) Exit"

      read -p "Choose an option [1-4]: " main_option

      case $main_option in
          1) all_menu ;;
          2) supabase_menu ;;
          3) main_menu ;;
          4) echo "ğŸ‘‹ Exiting..."; exit 0 ;;
          *) echo "âŒ Invalid option. Please choose a number between 1 and 4."; main_menu ;;
      esac
  }

# Start the script
main_menu
